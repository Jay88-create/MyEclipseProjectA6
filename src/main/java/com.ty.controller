package com.ty.controller;

import java.io.IOException;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.SQLException;

import javax.servlet.RequestDispatcher;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.ty.conn.ConnectionPool;

@WebServlet("/displayus")
public class Register extends HttpServlet {

    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp)
            throws ServletException, IOException {

        int sid = Integer.parseInt(req.getParameter("sid"));
        String name = req.getParameter("name");
        String email = req.getParameter("email");
        long phone = Long.parseLong(req.getParameter("phone"));
        String address = req.getParameter("address");
        int std = Integer.parseInt(req.getParameter("std")); 

        try {
            Connection conn = ConnectionPool.giveConnection();

            String insert =
                "INSERT INTO STUDENT(sid, name, email, phone, address, std) VALUES(?,?,?,?,?,?)";

            PreparedStatement pstm = conn.prepareStatement(insert);

            pstm.setInt(1, sid);
            pstm.setString(2, name);
            pstm.setString(3, email);
            pstm.setLong(4, phone);
            pstm.setString(5, address);
            pstm.setInt(6, std);

            int result = pstm.executeUpdate();
            ConnectionPool.submitConnection(conn);

            if (result > 0) {
                req.setAttribute("message", "User added successfully!");
            } else {
                req.setAttribute("message", "Failed to add user.");
            }

            req.getRequestDispatcher("add.jsp").forward(req, resp);

        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
